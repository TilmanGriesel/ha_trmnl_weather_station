<!--
Home Assistant TRMNL Weather Station v0.6.0

- GitHub: https://github.com/TilmanGriesel/ha_trmnl_weather_station
- License: MIT License

Changelog:
- v0.6.0: Fixed TRMNL framework layout structure for proper label/value alignment
- v0.5.1: Weather integration improvements, dev tools enhancement, HACS release preparation
- v0.5.0: Added weather provider entity integration with weather icons in CO2 gauge section
- v0.4.0: Expanded sensor support (up to 6 sensors), configurable update rates, new sensor types, entity icon attributes
- v0.3.2: Updated TRMNL recipe setup instructions, refactored code into logic modules
- v0.3.1: Fixed label positioning above sensor values, enhanced font-weight for values, updated shared template with icon mapping
- v0.3.0: Initial release - First official version with basic weather station and COâ‚‚ indicator functionality
-->

<style>
  .sensor-value {
    font-weight: 600 !important;
  }
  .gauge-container {
    position: relative;
    display: inline-block;
  }
  .weather-icon {
    position: absolute;
    top: 68%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 30px;
  }
</style>
<div class="layout layout--col gap--space-between">
  <div class="gauge-container">
    <div id="co2-gauge"></div>
    {% assign weather_icon = '' %}
    {% for icon_pair in weather_icon_map %}
    {% assign icon_data = icon_pair | split: ':' %}
    {% if icon_data[0] == weather_code %}
    {% assign weather_icon = icon_data[1] %}
    {% break %}
    {% endif %}
    {% endfor %}
    <span class="weather-icon mdi {{ weather_icon }}"></span>
  </div>
  <div class="item">
    <div class="grid grid--cols-2">
      {% for entity in entities %}
      {% if entity.type != 'co2_primary' %}
      {% if entity.i and entity.i != blank %}
      {% assign entity_icon = entity.i | replace: ':', '-' %}
      {% else %}
      {% assign entity_icon = 'mdi-gauge' %}
      {% for icon_pair in icon_map %}
      {% assign icon_data = icon_pair | split: ':' %}
      {% if icon_data[0] == entity.device_class %}
      {% assign entity_icon = icon_data[1] %}
      {% break %}
      {% endif %}
      {% endfor %}
      {% endif %}
      <div class="col">
        <div class="content">
          <span class="label">
            <span class="mdi {{ entity_icon }}"></span>
            {{ entity.n }}
          </span>
          <span class="value value--small value--tnums sensor-value">
            {%- if entity.val == "unavailable" -%}
            -
            {%- else -%}
            {{- entity.val -}}{{- entity.u -}}
            {%- endif -%}
          </span>
        </div>
      </div>
      {% endif %}
      {% endfor %}
    </div>
  </div>
</div>
<script type="text/javascript">
  createSimpleCO2Gauge({{ co2_value }}, 220);
</script>
